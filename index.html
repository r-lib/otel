<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>R Implementation of OpenTelemetry, exporters • otel</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="R Implementation of OpenTelemetry, exporters">
<meta name="description" content="High-quality, ubiquitous, and portable telemetry to enable effective observability. OpenTelemetry is a collection of tools, APIs, and SDKs used to instrument, generate, collect, and export telemetry data (metrics, logs, and traces) for analysis in order to understand your softwares performance and behavior. Use this package as a dependency if you want to instrument your R package for OpenTelemetry'.">
<meta property="og:description" content="High-quality, ubiquitous, and portable telemetry to enable effective observability. OpenTelemetry is a collection of tools, APIs, and SDKs used to instrument, generate, collect, and export telemetry data (metrics, logs, and traces) for analysis in order to understand your softwares performance and behavior. Use this package as a dependency if you want to instrument your R package for OpenTelemetry'.">
<script defer data-domain="all.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">otel</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="otel">otel<a class="anchor" aria-label="anchor" href="#otel"></a>
</h1></div>
<blockquote>
<p>OpenTelemetry API for R packages and projects</p>
</blockquote>
<!-- badges: start -->

<p>High-quality, ubiquitous, and portable telemetry to enable effective observability. <a href="https://opentelemetry.io/docs/" class="external-link">OpenTelemetry</a> is a collection of tools, APIs, and SDKs used to instrument, generate, collect, and export telemetry data (metrics, logs, and traces) for analysis in order to understand your software’s performance and behavior.</p>
<div class="section level2">
<h2 id="the-otel-and-otelsdk-r-packages">The otel and otelsdk R packages<a class="anchor" aria-label="anchor" href="#the-otel-and-otelsdk-r-packages"></a>
</h2>
<p>Use the otel package as a dependency if you want to instrument your R package or project for OpenTelemetry.</p>
<p>Use the <a href="https://github.com/r-lib/otelsdk" class="external-link">otelsdk</a> package to produce OpenTelemetry output from an R package or project that was instrumented with the otel package.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install otel from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"otel"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version of otel from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"r-lib/otel"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<ul>
<li>Call <code><a href="reference/start_span.html">otel::start_span()</a></code> to create a span. By default the span ends when the caller function exits.</li>
<li>Use the <code>$set_attribute()</code>, <code>$add_event()</code>, <code>$add_link()</code> and <code>$set_status()</code> methods of a span to manipulate it.</li>
<li>See the <a href="https://github.com/r-lib/otelsdk" class="external-link">otelsdk</a> package for producing output from an instrumented R package or project.</li>
</ul>
</div>
<div class="section level2">
<h2 id="zero-code-instrumentation">Zero-code instrumentation<a class="anchor" aria-label="anchor" href="#zero-code-instrumentation"></a>
</h2>
<p>otel supports zero-code instrumentation via the <code>OTEL_INSTRUMENT_R_PKGS</code> environment variable. Set this to a comma separated list of package names, the packages that you want to instrument. Then otel will hook up <code><a href="https://rdrr.io/r/base/trace.html" class="external-link">base::trace()</a></code> to produce OpenTelemetry output from every function of these packages.</p>
<p>By default all functions of the listed packages are instrumented. To instrument a subset of all functions set the <code>OTEL_INSTRUMENT_R_PKGS_&lt;PKG&gt;_INCLUDE</code> environment variable to a list of glob expressions. <code>&lt;PKG&gt;</code> is the package name in all capital letters. Only functions that match to at least one glob expression will be instrumented.</p>
<p>To exclude functions from instrumentation, set the <code>OTEL_INSTRUMENT_R_PKGS_&lt;PKG&gt;_EXCLUDE</code> environment variable to a list of glob expressions. <code>&lt;PKG&gt;</code> is the package name in all capital letters. Functions that match to at least one glob expression will not be instrumented. Inclusion globs are applied before exclusion globs.</p>
</div>
<div class="section level2">
<h2 id="production-and-development-r-sessions">Production and development R sessions<a class="anchor" aria-label="anchor" href="#production-and-development-r-sessions"></a>
</h2>
<p>Bye default otel and otelsdk run in production mode. In production mode otel (and otelsdk) functions never error. This behavior does not help catching errors early during the development of the instrumented project. Set the <code>OTEL_ENV</code> environment variable to <code>dev</code> to switch to development mode, where otel and otelsdk functions fail on errors.</p>
</div>
<div class="section level2">
<h2 id="concurrency">Concurrency<a class="anchor" aria-label="anchor" href="#concurrency"></a>
</h2>
<p>To support concurrency on a single thread, e.g. a Shiny app serving multiple requests at the same time, you can manage the lifetime and activation of the OpenTelemetry spans manually. We recommend the following practices for in-process concurrency:</p>
<ul>
<li>Create a new long lasting span with <code>otel::start_span(scope = NULL)</code>.</li>
<li>Assign the returned span into the corresponding object of the concurrent and/or asynchronous computation. Every span has a finalizer that closes the span.</li>
<li>When running code that belongs concurrent computation represented by the span, activate it for a specific R scope by calling <code><a href="reference/with_active_span.html">with_active_span()</a></code> or <code><a href="reference/local_active_span.html">local_active_span()</a></code>.</li>
<li>When logging use <code><a href="reference/with_active_span.html">with_active_span()</a></code> or <code><a href="reference/local_active_span.html">local_active_span()</a></code> to activate the span that belongs to the log messages.</li>
<li>Similarly, for metrics, call <code><a href="reference/with_active_span.html">with_active_span()</a></code> or <code><a href="reference/local_active_span.html">local_active_span()</a></code> to link instruments to the correct span.</li>
<li>When the concurrent computation ends, close the span manually with its <code>$end()</code> method. (Otherwise it would be only closed at the next garbage collection, assuming there are no references to it.)</li>
</ul>
</div>
<div class="section level2">
<h2 id="shiny-apps">Shiny apps<a class="anchor" aria-label="anchor" href="#shiny-apps"></a>
</h2>
<p>otel has convenience functions to tie otel spans to Shiny sessions:</p>
<ul>
<li>Call <code><a href="reference/start_shiny_app.html">start_shiny_app()</a></code> from the <code>global.R</code> file, before the app starts up.</li>
<li>Call <code><a href="reference/start_shiny_session.html">start_shiny_session()</a></code> from the server function, at the start of a new Shiny session, and pass the Shiny session object to it. <code><a href="reference/start_shiny_session.html">start_shiny_session()</a></code> creates a long lasting OpenTelemetry span in <code>session$userData$otel_span</code>. This span represents the Shiny session, see ‘Concurrency’ above.</li>
<li>Call <code>otel::local_active_span(session$userData$otel_span)</code> at the beginning of each reactive expression to switch to the span that represents the current Shiny session.</li>
</ul>
<p>See the examples included in the otel package.</p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT © Posit, PBC</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing otel</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a> <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/r-lib/otel/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/r-lib/otel/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://github.com/r-lib/otel/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/r-lib/otel/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/r-lib/otel" class="external-link"><img src="https://codecov.io/gh/r-lib/otel/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
